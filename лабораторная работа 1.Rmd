---
title: "Лабораторная работа 1"
author: "Бочкарев Никита"
date: "10 12 2020"
output: word_document
---

```{r setup, include=FALSE}
library('Hmisc') # для расчёта корреляционной матрицы
library('corrplot') # визуализация корреляционных матриц
library('knitr') # для генерации отчёта
library('nortest') # тест на нормальность: ad.test()
knitr::opts_chunk$set(echo = FALSE)
```
# раздел 1. проверка статистических данных.
В этом разделе необходимо собрать данные по социально-экономическим показателям в регионах РФ и изучить их взаимосвязи.

**требуется построить:**

* коробчатые диаграммы распределения показателей.

* Тест Шапира-Уилка на нормальность: таблица со статистикой теста, критическим значением и выводом по каждой переменной.

* Точечные графики взаимного разброса (?pairs), сделать маркеры полупрозрачными.

* Взаимосвязь показателей: графическое представление корреляционной матрицы с помощью функции corrplot(). Незначимые коэффициенты корреляции скрыть, остальные показать кругами.

## импорт данных:
```{r import}
# импорт данных из .csv
file.path<-'Бочкарев_Никита.CSV'
DF<-read.csv2(file.path,stringsAsFactors = F)
dim(DF)
# структура фрейма
str(DF)
# делаем из столбца "FO" фактор
DF$FO <- as.factor(DF$FO)
str(DF)
# оставляем только регионы и выбрасываем столбец меток,
# чтобы удобнее было считать
reg.df <- DF[DF$Reg.code<1000,c(-1,-2)]
# выбрасываем пропущенные
reg.df <- na.omit(reg.df)


```

были созданы 2 фрэйма DF и reg.df в которых находятся данные вместе с названиями округов и с показателями для дальнейших подсчетов соответственно.

Эти 2 фрейма содержут: DF 94 строки и 8 столбцов reg.df - 76 строк и 6 столбцов.

Структура этих фреймов:


1:

```{r}
str(DF)
```

2:

```{r}
str(reg.df)
```


## подсчет описательной статистики

```{r}
# средние арифметические
mns <- round(apply(reg.df[, -1], 2, mean), 1)

# стандартные отклонения
sds <- round(apply(reg.df[,-1], 2, sd), 1)

# коэффициенты вариации
coef.vars <- round(sds/mns*100, 1)

smm <- rbind(mns, sds, coef.vars) # соединить как строки
# названия статистик -- заголовки строк
row.names(smm) <- c('Среднее', 'Стандартное отклонение',
                    'Коэффициент вариации, %')
kable(smm)
```

**вывод:** показатели неоднородные кроме x3


## проверка показателей на нормальное распределение с помощью теста Шапиро-Уилка

# тест Шапиро Уилка на нормальность

```{r}
# тест Шапиро Уилка на нормальность
# shapiro.test(reg.df$y)
# sapply(reg.df[, 2:6], shapiro.test)
krit.zn <- sapply(reg.df[, 2:6], function(x){
  round(t.test(x)$statistic, 4)
})
st<- sapply(reg.df[, 2:6], function(x){
  round(shapiro.test(x)$statistic, 4)
})
p<-sapply(reg.df[, 2:6], function(x){
  round(shapiro.test(x)$p.value, 8)
})
table<-data.frame(st, krit.zn, p)
kable(table)
```

Можно сделать вывод о том, что только x3 имеет нормальное распределение, так как p-значение больше уровня значимости 0,05.


## Построение диаграмм, графиков разброса и матрици корреляции
# коробчатые диаграммы

```{r}

# строим коробки на одном полотне
par(mfrow = c(3, 2)) # разбить полотно на 5 части, 3x2
par(oma = c(0, 0, 1.5, 0)) # внешние поля общего полотна
par(mar = c(4, 4, 0.5, 0.5)) # внутренние поля каждого графика
# цикл по номерам столбцов с количественными переменными
for (i in 2:6) {
  # данные -- i-ый столбец фрейма
  x <- reg.df[, i]
  boxplot(x)
}
# общий заголовок для всех графиков
title(main = 'коробчатые диаграммы распределения показателей',
      outer = TRUE, cex = 1.5)
par(mfrow = c(1, 1)) # вернуть настройки обратно, 1x1

```


# график разброса


```{r}
# графики взаимного разброса
pairs(reg.df[, -1], # фрейм без первого столбца-фактора
      pch = 21, # тип символов для точек
      col = rgb(0, 0, 1, alpha = 0.4), # цвет заливки точек
      bg = rgb(0, 0, 1, alpha = 0.4), # цвет границы точек
      cex = 1.1) # масштаб символов для точек
```

Можно сделать вывод о том, что связь между главным и зависимыми переменными непрослеживается.

# матрица корреляции

```{r}
# коэффициенты Пирсона с P-значениями
 # rcorr(as.matrix(reg.df[, -1]))


# Визуализация корреляционной матрицы  =========================================

# сохраняем корреляционную матрицу
matrix.cor <- cor(reg.df[, -1])

# сохраняем p-значения
matrix.p <- rcorr(as.matrix(reg.df[, -1]))$P

# изображаем матрицу графически
corrplot(matrix.cor,          # сама корреляционная матрица
         order = 'original',  # порядок отображения показателей 
         # в матрице
         diag = F,            # не отображать значения на главной 
         # диагонали
         p.mat = matrix.p,    # p-значения
         insig = 'blank',     # метод отображения незначимых
         sig.level = 0.05)    # уровень значимости
```


# вывод
с y связаны переменные x1, x2, x4, x3

# раздел 2. работа с логарифмированными данными
## описательная статистика

```{r}
##логарифмируем данные:==============================================
lg <- reg.df
lg$y <- log(reg.df$y)
lg$x1 <- log(reg.df$x1)
lg$x2 <- log(reg.df$x2)
lg$x3 <- log(reg.df$x3)
lg$x4 <- log(reg.df$x4)
#описательна ястатистикаа
# средние арифметические
mns1 <- round(apply(lg[, -1], 2, mean), 4)
# стандартные отклонения
sds1 <- round(apply(lg[,-1], 2, sd), 4)
# коэффициенты вариации
coef.vars1 <- round(sds1/mns1*100, 4)
smm1 <- rbind(mns1, sds1, coef.vars1) # соединить как строки
# названия статистик -- заголовки строк
row.names(smm1) <- c('Среднее', 'Стандартное отклонение',
                    'Коэффициент вариации, %')
kable(smm1)
```


После логарифмирования данные стали однородными, так как коэффициенты вариации не привышают 30 %.

# статистические тесты (Шапиро Уилка на нормальность)

```{r}
 # shapiro.test(lg$y)
 # sapply(lg[, 2:6], shapiro.test)
krit.zn1 <- sapply(lg[, 2:6], function(x){
  round(t.test(x)$statistic, 4)
})
st1<-sapply(lg[, 2:6], function(x){
  round(shapiro.test(x)$statistic, 4)
})
p1 <-sapply (lg[, 2:6], function(x){
  round(shapiro.test(x)$p.value, 8)
})
table11<-data.frame(st1, krit.zn1, p1)
kable(table11)

```

Большинство переменных больше уровня значимости.

## Построение диаграмм, графиков разброса и матрици корреляции
# коробчатые диаграммы

```{r}
#строим коробчатую диаграмму 
# строим коробки на одном полотне
par(mfrow = c(3, 2)) # разбить полотно на 5 части, 3x2
par(oma = c(0, 0, 1.5, 0)) # внешние поля общего полотна
par(mar = c(4, 4, 0.5, 0.5)) # внутренние поля каждого графика
# цикл по номерам столбцов с количественными переменными
for (i in 2:6) {
  # данные -- i-ый столбец фрейма
  x <- lg[, i]
  boxplot(x)
}
# общий заголовок для всех графиков
title(main = 'коробчатые диаграммы распределения логарифмов показателей',
      outer = TRUE, cex = 1.5)
par(mfrow = c(1, 1)) # вернуть настройки обратно, 1x1

```

# график разброса

```{r}
# графики взаимного разброса
pairs(lg[, -1], # фрейм без первого столбца-фактора
      pch = 21, # тип символов для точек
      col = rgb(0, 0, 1, alpha = 0.4), # цвет заливки точек
      bg = rgb(0, 0, 1, alpha = 0.4), # цвет границы точек
      cex = 1.1) # масштаб символов для точек

```

Между зависимой и объясняющими переменными наблюдается положительная свзь.

# Корреляционная матрица

```{r}
# коэффициенты Пирсона с P-значениями
# rcorr(as.matrix(lg[, -1]))


# Визуализация корреляционной матрицы  =========================================

# сохраняем корреляционную матрицу
matrix.cor1 <- cor(lg[, -1])

# сохраняем p-значения
matrix.p1 <- rcorr(as.matrix(lg[, -1]))$P

# изображаем матрицу графически
corrplot(matrix.cor1,          # сама корреляционная матрица
         order = 'original',  # порядок отображения показателей 
         # в матрице
         diag = F,            # не отображать значения на главной 
         # диагонали
         p.mat = matrix.p1,    # p-значения
         insig = 'blank',     # метод отображения незначимых
         sig.level = 0.05)    # уровень значимости

```


# вывод

с Y наибольшую связь имеет переменная x1 и x4 ,x2
